### The v1.3.5 Brief
This update focuses on **"Agentic Interfaces"**â€”making SlopChop machine-readable so tools like Roadmap (and Cursor/Antigravity) can use it reliably.

Here is the setup for the next AI.

XSC7XSC PLAN XSC7XSC
GOAL: Create the implementation brief for v1.3.5 (Agentic Interfaces & Trust Engine).
CHANGES:
1.  **Create `docs/active/v1.3.5-agentic-interfaces.md`**: Defines the JSON output, Sabotage command, and Spec extractor.
2.  **Update `docs/past-present-future.md`**: Transition v1.3.4 to Past, set v1.3.5 as Active.
XSC7XSC END XSC7XSC

XSC7XSC MANIFEST XSC7XSC
docs/active/v1.3.5-agentic-interfaces.md [NEW]
docs/past-present-future.md
XSC7XSC END XSC7XSC

XSC7XSC FILE XSC7XSC docs/active/v1.3.5-agentic-interfaces.md
# SlopChop v1.3.5: Agentic Interfaces & The Trust Engine

**Status:** Active / Draft
**Priority:** High
**Theme:** "Making SlopChop machine-readable."

## 1. Context
SlopChop is currently optimized for *human* usage (colors, spinners, interactive TUI). To function as the "Gatekeeper" for other tools (like Roadmap or autonomous Agents), it needs robust machine interfaces.

Additionally, we are introducing the "Trust Engine" capabilities to support Mutation Testing validation.

## 2. Features

### Feature A: JSON Output (`--json`)
**Problem:** Roadmap needs to know if `slopchop check` passed or failed, and *why*, without parsing ANSI color codes.
**Solution:** Add structured JSON output to core commands.

*   **Commands:** `slopchop check --json`, `slopchop scan --json`
*   **Schema (ScanReport):**
    ```json
    {
      "files": [
        { "path": "src/main.rs", "violations": [...] }
      ],
      "total_violations": 0,
      "scan_passed": true
    }
    ```
*   **Implementation:**
    *   Update `src/cli/args.rs` to add flags.
    *   Update `src/reporting.rs` to impl `print_json`.
    *   Update `src/types.rs` to derive `Serialize`.

### Feature B: The Sabotage Command (`slopchop sabotage`)
**Problem:** We need to prove tests are valid by intentionally breaking code.
**Solution:** A command that mutates source code in the **Stage** (never Workspace) to introduce logical faults.

*   **Command:** `slopchop sabotage <file>`
*   **Behavior:**
    1.  Parse file via Tree-sitter.
    2.  Identify a mutable node (Binary Op `==` -> `!=`, Boolean `true` -> `false`).
    3.  Apply mutation to the **Staged Worktree**.
    4.  Exit 0 (Success) if mutation applied, Exit 1 if no mutable logic found.
*   **Safety:** Must ONLY operate on `.slopchop/stage/worktree`.

### Feature C: Holographic Spec (`pack --spec`)
**Problem:** Documentation rot. We want "Code as Truth."
**Solution:** Extract `//!` and `///` comments into a clean Markdown document.

*   **Command:** `slopchop pack --spec`
*   **Behavior:**
    *   Iterate source files.
    *   Extract doc comments.
    *   Format as Markdown headers (e.g., `# src/lib.rs`).
    *   Output to stdout (or file via redirection).

## 3. Implementation Plan

1.  **JSON Plumbing:** Add `serde`, `serde_json` to `Cargo.toml` (if missing). derive `Serialize` on `ScanReport`, `Violation`, `FileReport`.
2.  **CLI Updates:** Add flags to `args.rs` and update `handlers.rs`.
3.  **Sabotage Engine:** Create `src/analysis/sabotage.rs`.
    *   Use tree-sitter to find ranges.
    *   Perform string replacement.
    *   Write to stage.
4.  **Spec Generator:** Update `src/pack/formats.rs` to handle doc extraction.

## 4. Success Criteria
*   `slopchop check --json | jq .total_violations` works.
*   `slopchop sabotage src/main.rs` modifies the staged file but leaves real file alone.
*   `slopchop pack --spec` produces a readable architecture doc.
XSC7XSC END XSC7XSC

XSC7XSC FILE XSC7XSC docs/past-present-future.md
# Past / Present / Future

**Status:** ACTIVE DEV - v1.3.5
**Last updated:** 2026-01-04 (v1.3.5)
**Canonical policy:** This document states the current operational reality and the single next action.

---

## 1) Past (What changed recently)

**v1.3.4: UX Polish & Config.**
- **Interactive Config:** `slopchop config` TUI using crossterm.
- **Workflow Repairs:** Fixed `pack` auto-copy, restored paste-back packet.
- **Maintenance:** Removed `ratatui` dependency, wired `auto_promote` preference.

**v1.3.3: Cross-Platform Reliability.**
- Unified hash normalization (CRLF fix).
- Multi-patch verification stability.

---

## 2) Present (Where we are right now)

**Status:** ACTIVE DEVELOPMENT (v1.3.5)

We are building the "Agentic Interfaces" to allow SlopChop to integrate with Roadmap and autonomous agents.

### Core Commands

| Command | Purpose | Status |
|---------|---------|--------|
| `scan` | Structural violation detection | Stable |
| `check` | Gate (external commands + scan) | Stable |
| `apply` | Staged ingestion | Stable |
| `config` | Interactive settings | Stable |
| `sabotage` | Mutation testing generator | **Planned (v1.3.5)** |

### Known Issues
- None blocking.

---

## 3) Future (What we do next)

### v1.3.5: Agentic Interfaces & Trust Engine

| Feature | Description | Priority |
|---------|-------------|----------|
| **JSON Output** | `--json` for `check`/`scan`. Critical for Roadmap integration. | High |
| **Sabotage** | `slopchop sabotage <file>`. Breaks code in stage to verify tests. | High |
| **Holographic Spec** | `pack --spec`. Extracts doc comments into architectural markdown. | Medium |

### v1.4.0: Distribution
- Installers (Scoop, Homebrew).

---

## 4) Non-Goals
- **Python Support:** Frozen.
- **Advanced Viz:** Dashboard deleted.
- **Git Hooks:** Not core.

---

## 5) Architecture Notes

### The Trust Engine (v1.3.5+)
We are introducing `slopchop sabotage` to solve the "Fox Guarding the Henhouse" problem with AI-generated tests. By automating the breakage of code within the safety of the Staged Workspace, we can mathematically prove if a test suite is valid or vacuous.
